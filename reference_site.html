<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ì‚¬ì£¼ ê³„ì‚°ê¸°</title>
  <link href="https://cdn.replit.com/agent/bootstrap-agent-dark-theme.min.css" rel="stylesheet">
  <style>
    html { scroll-behavior: smooth; }
  </style>
</head>
<body class="bg-dark text-white">
  <div class="container py-5">
    <h1 class="mb-4">ì‚¬ì£¼íŒ”ì ë§Œì„¸ë ¥ ê³„ì‚°ê¸°</h1>
    <div class="card bg-dark border-secondary mb-4">
      <div class="card-body">
        <form id="sajuForm" class="row g-3">
          <!-- 1) ì—°ë„ -->
          <div class="col-md-4">
            <label class="form-label">ì—°ë„:</label>
            <input type="number" id="y" class="form-control" value="1983" min="1900" max="2100" required>
          </div>
          <!-- 2) ì›” -->
          <div class="col-md-2">
            <label class="form-label">ì›”:</label>
            <input type="number" id="m" class="form-control" value="12" min="1" max="12" required>
          </div>
          <!-- 3) ì¼ -->
          <div class="col-md-2">
            <label class="form-label">ì¼:</label>
            <input type="number" id="d" class="form-control" value="25" min="1" max="31" required>
          </div>
          <!-- 4) ì‹œ -->
          <div class="col-md-2">
            <label class="form-label">ì‹œ (0~23):</label>
            <input type="number" id="hh" class="form-control" value="0" min="0" max="23">
          </div>
          <!-- 5) ë¶„ -->
          <div class="col-md-2">
            <label class="form-label">ë¶„ (0~59):</label>
            <input type="number" id="mm" class="form-control" value="0" min="0" max="59">
          </div>
          <!-- 6) ë‹¬ë ¥ ì„ íƒ -->
          <div class="col-md-6">
            <label class="form-label">ë‹¬ë ¥:</label>
            <select id="calendar" class="form-select">
              <option value="solar">ì–‘ë ¥</option>
              <option value="lunar">ìŒë ¥</option>
            </select>
          </div>
          <!-- 7) ìœ¤ë‹¬ ì²´í¬ë°•ìŠ¤ -->
          <div class="col-md-3">
            <div class="form-check mt-4">
              <input type="checkbox" id="leap" class="form-check-input" disabled>
              <label class="form-check-label" for="leap">ìœ¤ë‹¬</label>
            </div>
          </div>
          <!-- 8) ì„±ë³„ ë¼ë””ì˜¤ ë²„íŠ¼ -->
          <div class="col-md-3">
            <label class="form-label">ì„±ë³„:</label>
            <div>
              <div class="form-check form-check-inline">
                <input type="radio" id="gender-male" name="gender" value="ë‚¨" class="form-check-input">
                <label class="form-check-label" for="gender-male">ë‚¨ì</label>
              </div>
              <div class="form-check form-check-inline">
                <input type="radio" id="gender-female" name="gender" value="ì—¬" class="form-check-input" checked>
                <label class="form-check-label" for="gender-female">ì—¬ì</label>
              </div>
            </div>
          </div>
          <!-- 9) ê³„ì‚°í•˜ê¸° ë²„íŠ¼ -->
          <div class="col-12 mt-3">
            <button type="button" id="calculate-btn"
                    class="btn btn-primary w-100 btn-lg"
                    onclick="submitForm()">ê³„ì‚°í•˜ê¸°</button>
            <div class="form-text">ê³„ì‚°í•˜ê¸°ë¥¼ ëˆ„ë¥´ë©´ ì•„ë˜ìª½ì— ê²°ê³¼ê°’ì´ ì¶œë ¥ë©ë‹ˆë‹¤.</div>
          </div>
        </form>
      </div>
    </div>

    <!-- ë¡œë”©Â·ì˜¤ë¥˜ í‘œì‹œ -->
    <div id="loading" class="text-center my-5" style="display:none;">
      <div class="spinner-border text-info" role="status"></div>
      <p class="mt-2">ê³„ì‚° ì¤‘...</p>
    </div>
    <div id="error-container" class="alert alert-danger" style="display:none;">
      <strong>ì˜¤ë¥˜:</strong> <span id="error-message"></span>
    </div>

    <!-- ê²°ê³¼ ì˜ì—­ -->
    <div id="results-container" class="mt-5" style="display:none;">
      <p>ì–‘ë ¥: <span id="converted-date" style="font-size:0.9rem; color:#0dcaf0;"></span></p>

      <div class="mb-3">
        <button type="button" id="copy-btn" class="btn btn-success w-100 btn-lg" style="font-size:1.2rem; display:none;" onclick="copyAll()">
          ğŸ“‹ ì‚¬ì£¼ ê²°ê³¼ ë³µì‚¬í•˜ê¸°
        </button>
        <div id="copy-info" class="alert alert-info mt-2" style="display:none;">
          ì‚¬ì£¼íŒ”ìê°€ ê³„ì‚° ë˜ì—ˆìŠµë‹ˆë‹¤. ìœ„ ë³µì‚¬ ë²„íŠ¼ì„ ëˆŒëŸ¬ì„œ ChatGPTì— ë¶™ì´ì‹œë©´ ë©ë‹ˆë‹¤.
        </div>
      </div>

      <!-- ì‚¬ì£¼ 4ì£¼ -->
      <h3 id="pillars-title">ì‚¬ì£¼ 4ì£¼</h3>
      <table class="table table-dark table-striped align-middle mb-5">
        <thead><tr><th>ì‹œì£¼</th><th>ì¼ì£¼</th><th>ì›”ì£¼</th><th>ì—°ì£¼</th></tr></thead>
        <tbody><tr>
          <td id="pillar-hour"></td>
          <td id="pillar-day"></td>
          <td id="pillar-month"></td>
          <td id="pillar-year"></td>
        </tr></tbody>
      </table>

      <!-- ì˜¤í–‰ ë¶„í¬ -->
      <h3>ì˜¤í–‰ ë¶„í¬</h3>
      <table class="table table-dark table-striped align-middle mb-5">
        <thead><tr><th>ëª©</th><th>í™”</th><th>í† </th><th>ê¸ˆ</th><th>ìˆ˜</th></tr></thead>
        <tbody><tr>
          <td id="elem-ëª©"></td>
          <td id="elem-í™”"></td>
          <td id="elem-í† "></td>
          <td id="elem-ê¸ˆ"></td>
          <td id="elem-ìˆ˜"></td>
        </tr></tbody>
      </table>

      <!-- ì‹­ì„± & 12ìš´ì„± í•´ì„ -->
      <h3>ì‹­ì„± &amp; 12ìš´ì„± í•´ì„</h3>
      <table class="table table-dark table-striped align-middle mb-5">
        <thead><tr><th>êµ¬ë¶„</th><th>ì‹œì£¼</th><th>ì¼ì£¼</th><th>ì›”ì£¼</th><th>ì—°ì£¼</th></tr></thead>
        <tbody id="deep-body"></tbody>
      </table>

      <!-- ì²œê°„ íŠ¹ìˆ˜ê´€ê³„ -->
      <h3>ì²œê°„ íŠ¹ìˆ˜ê´€ê³„</h3>
      <div id="stem-relation-container" style="display:none;">
        <ul id="stem-relation-list" class="list-group list-group-flush mb-4"></ul>
      </div>

      <!-- ì§€ì§€í˜•ì¶©íšŒí•© í•´ì„ -->
      <h3>ì§€ì§€í˜•ì¶©íšŒí•© í•´ì„</h3>
          <table class="table table-dark table-striped align-middle mb-5"
             style="table-layout: fixed; width:100%; border-collapse:collapse;">
          <colgroup>
          <col style="width:10%"><!-- 'í•­ëª©' ì—´ -->
          <col style="width:22.5%"><!-- 'ì‹œì£¼' ì—´ -->
          <col style="width:22.5%"><!-- 'ì¼ì£¼' ì—´ -->
          <col style="width:22.5%"><!-- 'ì›”ì£¼' ì—´ -->
          <col style="width:22.5%"><!-- 'ì—°ì£¼' ì—´ -->
        </colgroup>
        <thead>
          <tr>
            <th>í•­ëª©</th><th>ì‹œì£¼</th><th>ì¼ì£¼</th><th>ì›”ì£¼</th><th>ì—°ì£¼</th>
          </tr>
        </thead>
        <tbody>
          <tr><th class="bg-secondary">ì§€ì¥ê°„</th>
            <td id="rel-ì§€ì¥ê°„-hour"></td><td id="rel-ì§€ì¥ê°„-day"></td>
            <td id="rel-ì§€ì¥ê°„-month"></td><td id="rel-ì§€ì¥ê°„-year"></td>
          </tr>
          <tr><th class="bg-secondary">ë°©í•©</th>
            <td id="rel-ë°©í•©-hour"></td><td id="rel-ë°©í•©-day"></td>
            <td id="rel-ë°©í•©-month"></td><td id="rel-ë°©í•©-year"></td>
          </tr>
          <tr><th class="bg-secondary">ì‚¼í•©</th>
            <td id="rel-ì‚¼í•©-hour"></td><td id="rel-ì‚¼í•©-day"></td>
            <td id="rel-ì‚¼í•©-month"></td><td id="rel-ì‚¼í•©-year"></td>
          </tr>
          <tr><th class="bg-secondary">ë°˜í•©</th>
            <td id="rel-ë°˜í•©-hour"></td><td id="rel-ë°˜í•©-day"></td>
            <td id="rel-ë°˜í•©-month"></td><td id="rel-ë°˜í•©-year"></td>
          </tr>
          <tr><th class="bg-secondary">ê°€í•©</th>
            <td id="rel-ê°€í•©-hour"></td><td id="rel-ê°€í•©-day"></td>
            <td id="rel-ê°€í•©-month"></td><td id="rel-ê°€í•©-year"></td>
          </tr>
          <tr><th class="bg-secondary">ìœ¡í•©</th>
            <td id="rel-ìœ¡í•©-hour"></td><td id="rel-ìœ¡í•©-day"></td>
            <td id="rel-ìœ¡í•©-month"></td><td id="rel-ìœ¡í•©-year"></td>
          </tr>
          <tr><th class="bg-secondary">ì•”í•©</th>
            <td id="rel-ì•”í•©-hour"></td><td id="rel-ì•”í•©-day"></td>
            <td id="rel-ì•”í•©-month"></td><td id="rel-ì•”í•©-year"></td>
          </tr>
          <tr><th class="bg-secondary">ì¶©</th>
            <td id="rel-ì¶©-hour"></td><td id="rel-ì¶©-day"></td>
            <td id="rel-ì¶©-month"></td><td id="rel-ì¶©-year"></td>
          </tr>
          <tr><th class="bg-secondary">í˜•</th>
            <td id="rel-í˜•-hour"></td><td id="rel-í˜•-day"></td>
            <td id="rel-í˜•-month"></td><td id="rel-í˜•-year"></td>
          </tr>
          <tr><th class="bg-secondary">íŒŒ</th>
            <td id="rel-íŒŒ-hour"></td><td id="rel-íŒŒ-day"></td>
            <td id="rel-íŒŒ-month"></td><td id="rel-íŒŒ-year"></td>
          </tr>
          <tr><th class="bg-secondary">í•´</th>
            <td id="rel-í•´-hour"></td><td id="rel-í•´-day"></td>
            <td id="rel-í•´-month"></td><td id="rel-í•´-year"></td>
          </tr>
          <tr><th class="bg-secondary">ì›ì§„</th>
            <td id="rel-ì›ì§„-hour"></td><td id="rel-ì›ì§„-day"></td>
            <td id="rel-ì›ì§„-month"></td><td id="rel-ì›ì§„-year"></td>
          </tr>
          <tr><th class="bg-secondary">ê·€ë¬¸</th>
            <td id="rel-ê·€ë¬¸-hour"></td><td id="rel-ê·€ë¬¸-day"></td>
            <td id="rel-ê·€ë¬¸-month"></td><td id="rel-ê·€ë¬¸-year"></td>
          </tr>
        </tbody>
      </table>
      <h3>ì‹­ì´ì‹ ì‚´,ì‹ ì‚´ ì¢…í•©</h3>
        <table class="table table-dark table-striped align-middle mb-5 fixed-table">
          <colgroup>
            <col style="width:10%"><!-- í•­ëª© ì—´ -->
            <col style="width:22.5%"><!-- ì‹œì£¼ ì—´ -->
            <col style="width:22.5%"><!-- ì¼ì£¼ ì—´ -->
            <col style="width:22.5%"><!-- ì›”ì£¼ ì—´ -->
            <col style="width:22.5%"><!-- ì—°ì£¼ ì—´ -->
          </colgroup>
        <thead>
          <tr>
            <th></th>
            <th>ì‹œì£¼</th>
            <th>ì¼ì£¼</th>
            <th>ì›”ì£¼</th>
            <th>ì—°ì£¼</th>
          </tr>
        </thead>
          <tbody>
            <tr>
              <th class="bg-secondary">ì‹­ì´ì‹ ì‚´</th>
              <td id="sal-stem-hour"  style="white-space: pre-line;"></td>
              <td id="sal-stem-day"   style="white-space: pre-line;"></td>
              <td id="sal-stem-month" style="white-space: pre-line;"></td>
              <td id="sal-stem-year"  style="white-space: pre-line;"></td>
            </tr>
            <tr>
              <th class="bg-secondary">ì‹ ì‚´</th>
              <td id="sal-god-hour" style="white-space: pre-line;"></td>
              <td id="sal-god-day" style="white-space: pre-line;"></td>
              <td id="sal-god-month" style="white-space: pre-line;"></td>
              <td id="sal-god-year"  style="white-space: pre-line;"></td>
            </tr>
          </tbody>
      </table>

      <!-- ëŒ€ìš´ í…Œì´ë¸” -->
      <div class="mb-5">
        <h3 id="daeun-title">ëŒ€ìš´ <small style="font-size: 0.6rem;">[í•œêµ­ì²œë¬¸ì—°êµ¬ì› ê¸°ì¤€]</small></h3>
        <table class="table table-dark table-striped align-middle">
          <colgroup>
            <col style="width:10%">
            <col style="width:9%">
            <col style="width:9%">
            <col style="width:9%">
            <col style="width:9%">
            <col style="width:9%">
            <col style="width:9%">
            <col style="width:9%">
            <col style="width:9%">
            <col style="width:9%">
            <col style="width:9%">
          </colgroup>
          <tbody>
            <tr>
              <th class="bg-secondary text-center">ëŒ€ìš´ë‚˜ì´</th>
              <td id="daeun-age-1" class="text-center">-</td>
              <td id="daeun-age-2" class="text-center">-</td>
              <td id="daeun-age-3" class="text-center">-</td>
              <td id="daeun-age-4" class="text-center">-</td>
              <td id="daeun-age-5" class="text-center">-</td>
              <td id="daeun-age-6" class="text-center">-</td>
              <td id="daeun-age-7" class="text-center">-</td>
              <td id="daeun-age-8" class="text-center">-</td>
              <td id="daeun-age-9" class="text-center">-</td>
              <td id="daeun-age-10" class="text-center">-</td>
            </tr>
            <tr>
              <th class="bg-secondary text-center">ê°„ì§€</th>
              <td id="daeun-gan-1" class="text-center">-</td>
              <td id="daeun-gan-2" class="text-center">-</td>
              <td id="daeun-gan-3" class="text-center">-</td>
              <td id="daeun-gan-4" class="text-center">-</td>
              <td id="daeun-gan-5" class="text-center">-</td>
              <td id="daeun-gan-6" class="text-center">-</td>
              <td id="daeun-gan-7" class="text-center">-</td>
              <td id="daeun-gan-8" class="text-center">-</td>
              <td id="daeun-gan-9" class="text-center">-</td>
              <td id="daeun-gan-10" class="text-center">-</td>
            </tr>
            <tr>
              <th class="bg-secondary text-center">ì²œê°„ì‹­ì„±</th>
              <td id="daeun-ji-1" class="text-center">-</td>
              <td id="daeun-ji-2" class="text-center">-</td>
              <td id="daeun-ji-3" class="text-center">-</td>
              <td id="daeun-ji-4" class="text-center">-</td>
              <td id="daeun-ji-5" class="text-center">-</td>
              <td id="daeun-ji-6" class="text-center">-</td>
              <td id="daeun-ji-7" class="text-center">-</td>
              <td id="daeun-ji-8" class="text-center">-</td>
              <td id="daeun-ji-9" class="text-center">-</td>
              <td id="daeun-ji-10" class="text-center">-</td>
            </tr>
            <tr>
              <th class="bg-secondary text-center">ì§€ì§€ì‹­ì„±</th>
              <td id="daeun-sipseong-1" class="text-center">-</td>
              <td id="daeun-sipseong-2" class="text-center">-</td>
              <td id="daeun-sipseong-3" class="text-center">-</td>
              <td id="daeun-sipseong-4" class="text-center">-</td>
              <td id="daeun-sipseong-5" class="text-center">-</td>
              <td id="daeun-sipseong-6" class="text-center">-</td>
              <td id="daeun-sipseong-7" class="text-center">-</td>
              <td id="daeun-sipseong-8" class="text-center">-</td>
              <td id="daeun-sipseong-9" class="text-center">-</td>
              <td id="daeun-sipseong-10" class="text-center">-</td>
            </tr>
            <tr>
              <th class="bg-secondary text-center">ì‹ ì‚´</th>
              <td id="daeun-sal-1" class="text-center">-</td>
              <td id="daeun-sal-2" class="text-center">-</td>
              <td id="daeun-sal-3" class="text-center">-</td>
              <td id="daeun-sal-4" class="text-center">-</td>
              <td id="daeun-sal-5" class="text-center">-</td>
              <td id="daeun-sal-6" class="text-center">-</td>
              <td id="daeun-sal-7" class="text-center">-</td>
              <td id="daeun-sal-8" class="text-center">-</td>
              <td id="daeun-sal-9" class="text-center">-</td>
              <td id="daeun-sal-10" class="text-center">-</td>
            </tr>
            <tr>
              <th class="bg-secondary text-center">12ìš´ì„±</th>
              <td id="daeun-12unsung-1" class="text-center">-</td>
              <td id="daeun-12unsung-2" class="text-center">-</td>
              <td id="daeun-12unsung-3" class="text-center">-</td>
              <td id="daeun-12unsung-4" class="text-center">-</td>
              <td id="daeun-12unsung-5" class="text-center">-</td>
              <td id="daeun-12unsung-6" class="text-center">-</td>
              <td id="daeun-12unsung-7" class="text-center">-</td>
              <td id="daeun-12unsung-8" class="text-center">-</td>
              <td id="daeun-12unsung-9" class="text-center">-</td>
              <td id="daeun-12unsung-10" class="text-center">-</td>
            </tr>
          </tbody>
        </table>
      </div>

      <!-- ì„¸ìš´(ë…„ìš´) í…Œì´ë¸” -->
      <div class="mb-5">
        <h3 id="seuun-title">ì„¸ìš´(ë…„ìš´)</h3>
        <table class="table table-dark table-striped align-middle">
          <colgroup>
            <col style="width:10%">
            <col style="width:9%">
            <col style="width:9%">
            <col style="width:9%">
            <col style="width:9%">
            <col style="width:9%">
            <col style="width:9%">
            <col style="width:9%">
            <col style="width:9%">
            <col style="width:9%">
            <col style="width:9%">
          </colgroup>
          <tbody>
            <tr>
              <th class="bg-secondary text-center">ì„¸ìš´ì—°ë„</th>
              <td id="seuun-year-1" class="text-center">-</td>
              <td id="seuun-year-2" class="text-center">-</td>
              <td id="seuun-year-3" class="text-center">-</td>
              <td id="seuun-year-4" class="text-center">-</td>
              <td id="seuun-year-5" class="text-center">-</td>
              <td id="seuun-year-6" class="text-center">-</td>
              <td id="seuun-year-7" class="text-center">-</td>
              <td id="seuun-year-8" class="text-center">-</td>
              <td id="seuun-year-9" class="text-center">-</td>
              <td id="seuun-year-10" class="text-center">-</td>
            </tr>
            <tr>
              <th class="bg-secondary text-center">ê°„ì§€</th>
              <td id="seuun-gan-1" class="text-center">-</td>
              <td id="seuun-gan-2" class="text-center">-</td>
              <td id="seuun-gan-3" class="text-center">-</td>
              <td id="seuun-gan-4" class="text-center">-</td>
              <td id="seuun-gan-5" class="text-center">-</td>
              <td id="seuun-gan-6" class="text-center">-</td>
              <td id="seuun-gan-7" class="text-center">-</td>
              <td id="seuun-gan-8" class="text-center">-</td>
              <td id="seuun-gan-9" class="text-center">-</td>
              <td id="seuun-gan-10" class="text-center">-</td>
            </tr>
            <tr>
              <th class="bg-secondary text-center">ì²œê°„ì‹­ì„±</th>
              <td id="seuun-cheongan-1" class="text-center">-</td>
              <td id="seuun-cheongan-2" class="text-center">-</td>
              <td id="seuun-cheongan-3" class="text-center">-</td>
              <td id="seuun-cheongan-4" class="text-center">-</td>
              <td id="seuun-cheongan-5" class="text-center">-</td>
              <td id="seuun-cheongan-6" class="text-center">-</td>
              <td id="seuun-cheongan-7" class="text-center">-</td>
              <td id="seuun-cheongan-8" class="text-center">-</td>
              <td id="seuun-cheongan-9" class="text-center">-</td>
              <td id="seuun-cheongan-10" class="text-center">-</td>
            </tr>
            <tr>
              <th class="bg-secondary text-center">ì§€ì§€ì‹­ì„±</th>
              <td id="seuun-jiji-1" class="text-center">-</td>
              <td id="seuun-jiji-2" class="text-center">-</td>
              <td id="seuun-jiji-3" class="text-center">-</td>
              <td id="seuun-jiji-4" class="text-center">-</td>
              <td id="seuun-jiji-5" class="text-center">-</td>
              <td id="seuun-jiji-6" class="text-center">-</td>
              <td id="seuun-jiji-7" class="text-center">-</td>
              <td id="seuun-jiji-8" class="text-center">-</td>
              <td id="seuun-jiji-9" class="text-center">-</td>
              <td id="seuun-jiji-10" class="text-center">-</td>
            </tr>
            <tr>
              <th class="bg-secondary text-center">ì‹ ì‚´</th>
              <td id="seuun-sal-1" class="text-center">-</td>
              <td id="seuun-sal-2" class="text-center">-</td>
              <td id="seuun-sal-3" class="text-center">-</td>
              <td id="seuun-sal-4" class="text-center">-</td>
              <td id="seuun-sal-5" class="text-center">-</td>
              <td id="seuun-sal-6" class="text-center">-</td>
              <td id="seuun-sal-7" class="text-center">-</td>
              <td id="seuun-sal-8" class="text-center">-</td>
              <td id="seuun-sal-9" class="text-center">-</td>
              <td id="seuun-sal-10" class="text-center">-</td>
            </tr>
            <tr>
              <th class="bg-secondary text-center">12ìš´ì„±</th>
              <td id="seuun-12unsung-1" class="text-center">-</td>
              <td id="seuun-12unsung-2" class="text-center">-</td>
              <td id="seuun-12unsung-3" class="text-center">-</td>
              <td id="seuun-12unsung-4" class="text-center">-</td>
              <td id="seuun-12unsung-5" class="text-center">-</td>
              <td id="seuun-12unsung-6" class="text-center">-</td>
              <td id="seuun-12unsung-7" class="text-center">-</td>
              <td id="seuun-12unsung-8" class="text-center">-</td>
              <td id="seuun-12unsung-9" class="text-center">-</td>
              <td id="seuun-12unsung-10" class="text-center">-</td>
            </tr>
          </tbody>
        </table>
      </div>

      <!-- ì›”ìš´ í…Œì´ë¸” -->
      <div class="mb-5">
        <h3>ì›”ìš´</h3>
        <table class="table table-dark table-striped align-middle">
          <colgroup>
            <col style="width:7.7%">
            <col style="width:7.7%">
            <col style="width:7.7%">
            <col style="width:7.7%">
            <col style="width:7.7%">
            <col style="width:7.7%">
            <col style="width:7.7%">
            <col style="width:7.7%">
            <col style="width:7.7%">
            <col style="width:7.7%">
            <col style="width:7.7%">
            <col style="width:7.7%">
            <col style="width:7.7%">
          </colgroup>
          <tbody>
            <tr>
              <th class="bg-secondary text-center">ì›”ìš´ì›”</th>
              <td id="wolun-month-1" class="text-center">-</td>
              <td id="wolun-month-2" class="text-center">-</td>
              <td id="wolun-month-3" class="text-center">-</td>
              <td id="wolun-month-4" class="text-center">-</td>
              <td id="wolun-month-5" class="text-center">-</td>
              <td id="wolun-month-6" class="text-center">-</td>
              <td id="wolun-month-7" class="text-center">-</td>
              <td id="wolun-month-8" class="text-center">-</td>
              <td id="wolun-month-9" class="text-center">-</td>
              <td id="wolun-month-10" class="text-center">-</td>
              <td id="wolun-month-11" class="text-center">-</td>
              <td id="wolun-month-12" class="text-center">-</td>
            </tr>
            <tr>
              <th class="bg-secondary text-center">ê°„ì§€</th>
              <td id="wolun-gan-1" class="text-center">-</td>
              <td id="wolun-gan-2" class="text-center">-</td>
              <td id="wolun-gan-3" class="text-center">-</td>
              <td id="wolun-gan-4" class="text-center">-</td>
              <td id="wolun-gan-5" class="text-center">-</td>
              <td id="wolun-gan-6" class="text-center">-</td>
              <td id="wolun-gan-7" class="text-center">-</td>
              <td id="wolun-gan-8" class="text-center">-</td>
              <td id="wolun-gan-9" class="text-center">-</td>
              <td id="wolun-gan-10" class="text-center">-</td>
              <td id="wolun-gan-11" class="text-center">-</td>
              <td id="wolun-gan-12" class="text-center">-</td>
            </tr>
            <tr>
              <th class="bg-secondary text-center">ì²œê°„ì‹­ì„±</th>
              <td id="wolun-cheongan-1" class="text-center">-</td>
              <td id="wolun-cheongan-2" class="text-center">-</td>
              <td id="wolun-cheongan-3" class="text-center">-</td>
              <td id="wolun-cheongan-4" class="text-center">-</td>
              <td id="wolun-cheongan-5" class="text-center">-</td>
              <td id="wolun-cheongan-6" class="text-center">-</td>
              <td id="wolun-cheongan-7" class="text-center">-</td>
              <td id="wolun-cheongan-8" class="text-center">-</td>
              <td id="wolun-cheongan-9" class="text-center">-</td>
              <td id="wolun-cheongan-10" class="text-center">-</td>
              <td id="wolun-cheongan-11" class="text-center">-</td>
              <td id="wolun-cheongan-12" class="text-center">-</td>
            </tr>
            <tr>
              <th class="bg-secondary text-center">ì§€ì§€ì‹­ì„±</th>
              <td id="wolun-jiji-1" class="text-center">-</td>
              <td id="wolun-jiji-2" class="text-center">-</td>
              <td id="wolun-jiji-3" class="text-center">-</td>
              <td id="wolun-jiji-4" class="text-center">-</td>
              <td id="wolun-jiji-5" class="text-center">-</td>
              <td id="wolun-jiji-6" class="text-center">-</td>
              <td id="wolun-jiji-7" class="text-center">-</td>
              <td id="wolun-jiji-8" class="text-center">-</td>
              <td id="wolun-jiji-9" class="text-center">-</td>
              <td id="wolun-jiji-10" class="text-center">-</td>
              <td id="wolun-jiji-11" class="text-center">-</td>
              <td id="wolun-jiji-12" class="text-center">-</td>
            </tr>
            <tr>
              <th class="bg-secondary text-center">ì‹ ì‚´</th>
              <td id="wolun-sal-1" class="text-center">-</td>
              <td id="wolun-sal-2" class="text-center">-</td>
              <td id="wolun-sal-3" class="text-center">-</td>
              <td id="wolun-sal-4" class="text-center">-</td>
              <td id="wolun-sal-5" class="text-center">-</td>
              <td id="wolun-sal-6" class="text-center">-</td>
              <td id="wolun-sal-7" class="text-center">-</td>
              <td id="wolun-sal-8" class="text-center">-</td>
              <td id="wolun-sal-9" class="text-center">-</td>
              <td id="wolun-sal-10" class="text-center">-</td>
              <td id="wolun-sal-11" class="text-center">-</td>
              <td id="wolun-sal-12" class="text-center">-</td>
            </tr>
            <tr>
              <th class="bg-secondary text-center">12ìš´ì„±</th>
              <td id="wolun-12unsung-1" class="text-center">-</td>
              <td id="wolun-12unsung-2" class="text-center">-</td>
              <td id="wolun-12unsung-3" class="text-center">-</td>
              <td id="wolun-12unsung-4" class="text-center">-</td>
              <td id="wolun-12unsung-5" class="text-center">-</td>
              <td id="wolun-12unsung-6" class="text-center">-</td>
              <td id="wolun-12unsung-7" class="text-center">-</td>
              <td id="wolun-12unsung-8" class="text-center">-</td>
              <td id="wolun-12unsung-9" class="text-center">-</td>
              <td id="wolun-12unsung-10" class="text-center">-</td>
              <td id="wolun-12unsung-11" class="text-center">-</td>
              <td id="wolun-12unsung-12" class="text-center">-</td>
            </tr>
          </tbody>
        </table>
      </div>

    </div>
  </div>

  <script>
    // ì²œê°„ ì‹­ì„± ë§¤í•‘
    const GAN_TEN_GODS = {
      'ç”²': {'ç”²':'ë¹„ê²¬','ä¹™':'ê²ì¬','ä¸™':'ì‹ì‹ ','ä¸':'ìƒê´€','æˆŠ':'í¸ì¬','å·±':'ì •ì¬','åºš':'í¸ê´€','è¾›':'ì •ê´€','å£¬':'í¸ì¸','ç™¸':'ì •ì¸'},
      'ä¹™': {'ç”²':'ê²ì¬','ä¹™':'ë¹„ê²¬','ä¸™':'ìƒê´€','ä¸':'ì‹ì‹ ','æˆŠ':'ì •ì¬','å·±':'í¸ì¬','åºš':'ì •ê´€','è¾›':'í¸ê´€','å£¬':'ì •ì¸','ç™¸':'í¸ì¸'},
      'ä¸™': {'ç”²':'í¸ì¸','ä¹™':'ì •ì¸','ä¸™':'ë¹„ê²¬','ä¸':'ê²ì¬','æˆŠ':'ì‹ì‹ ','å·±':'ìƒê´€','åºš':'í¸ì¬','è¾›':'ì •ì¬','å£¬':'í¸ê´€','ç™¸':'ì •ê´€'},
      'ä¸': {'ç”²':'ì •ì¸','ä¹™':'í¸ì¸','ä¸™':'ê²ì¬','ä¸':'ë¹„ê²¬','æˆŠ':'ìƒê´€','å·±':'ì‹ì‹ ','åºš':'ì •ì¬','è¾›':'í¸ì¬','å£¬':'ì •ê´€','ç™¸':'í¸ê´€'},
      'æˆŠ': {'ç”²':'í¸ê´€','ä¹™':'ì •ê´€','ä¸™':'í¸ì¸','ä¸':'ì •ì¸','æˆŠ':'ë¹„ê²¬','å·±':'ê²ì¬','åºš':'ì‹ì‹ ','è¾›':'ìƒê´€','å£¬':'í¸ì¬','ç™¸':'ì •ì¬'},
      'å·±': {'ç”²':'ì •ê´€','ä¹™':'í¸ê´€','ä¸™':'ì •ì¸','ä¸':'í¸ì¸','æˆŠ':'ê²ì¬','å·±':'ë¹„ê²¬','åºš':'ìƒê´€','è¾›':'ì‹ì‹ ','å£¬':'ì •ì¬','ç™¸':'í¸ì¬'},
      'åºš': {'ç”²':'í¸ì¬','ä¹™':'ì •ì¬','ä¸™':'í¸ê´€','ä¸':'ì •ê´€','æˆŠ':'í¸ì¸','å·±':'ì •ì¸','åºš':'ë¹„ê²¬','è¾›':'ê²ì¬','å£¬':'ì‹ì‹ ','ç™¸':'ìƒê´€'},
      'è¾›': {'ç”²':'ì •ì¬','ä¹™':'í¸ì¬','ä¸™':'ì •ê´€','ä¸':'í¸ê´€','æˆŠ':'ì •ì¸','å·±':'í¸ì¸','åºš':'ê²ì¬','è¾›':'ë¹„ê²¬','å£¬':'ìƒê´€','ç™¸':'ì‹ì‹ '},
      'å£¬': {'ç”²':'ì‹ì‹ ','ä¹™':'ìƒê´€','ä¸™':'í¸ì¬','ä¸':'ì •ì¬','æˆŠ':'í¸ê´€','å·±':'ì •ê´€','åºš':'í¸ì¸','è¾›':'ì •ì¸','å£¬':'ë¹„ê²¬','ç™¸':'ê²ì¬'},
      'ç™¸': {'ç”²':'ìƒê´€','ä¹™':'ì‹ì‹ ','ä¸™':'ì •ì¬','ä¸':'í¸ì¬','æˆŠ':'ì •ê´€','å·±':'ì •ê´€','åºš':'ì •ì¸','è¾›':'í¸ì¸','å£¬':'ê²ì¬','ç™¸':'ë¹„ê²¬'}
    };

    // ì§€ì§€ ì§€ì¥ê°„ ë§¤í•‘ (ì •ê¸°ë§Œ)
    const BRANCH_HIDDEN_GANS = {
      'å­': 'ç™¸', 'ä¸‘': 'å·±', 'å¯…': 'ç”²', 'å¯': 'ä¹™',
      'è¾°': 'æˆŠ', 'å·³': 'ä¸™', 'åˆ': 'ä¸', 'æœª': 'å·±',
      'ç”³': 'åºš', 'é…‰': 'è¾›', 'æˆŒ': 'æˆŠ', 'äº¥': 'å£¬'
    };

    // ì²œê°„, ì§€ì§€ ë°°ì—´
    const HEAVENLY_STEMS = ['ç”²','ä¹™','ä¸™','ä¸','æˆŠ','å·±','åºš','è¾›','å£¬','ç™¸'];
    const EARTHLY_BRANCHES = ['å­','ä¸‘','å¯…','å¯','è¾°','å·³','åˆ','æœª','ç”³','é…‰','æˆŒ','äº¥'];

    // ì‹­ì„± ê³„ì‚° í•¨ìˆ˜
    function getGanTenGod(dayGan, otherGan) {
      return GAN_TEN_GODS[dayGan]?.[otherGan] || 'ë¯¸ì •';
    }

    // ì§€ì¥ê°„ ì •ê¸° ì²œê°„ êµ¬í•˜ê¸°
    function getBranchHiddenGan(branch) {
      return BRANCH_HIDDEN_GANS[branch] || '';
    }

    // ì—°ê°„ì§€ ê³„ì‚° (ê°„ë‹¨í•œ ë°©ë²•)
    function getYearGanZhi(year) {
      const ganIndex = (year - 4) % 10;
      const zhiIndex = (year - 4) % 12;
      return HEAVENLY_STEMS[ganIndex] + EARTHLY_BRANCHES[zhiIndex];
    }

    // ìœ¤ë‹¬ í™œì„±í™” í† ê¸€
    function updateLeap() {
      const leap = document.getElementById('leap');
      leap.disabled = document.getElementById('calendar').value !== 'lunar';
      if (leap.disabled) leap.checked = false;
    }

    // ì „ì—­ ë³€ìˆ˜ë¡œ í˜„ì¬ Form ë°ì´í„° ì €ì¥
    let currentFormData = null;

    function saveFormData(data) {
      currentFormData = data;
    }

    function getCurrentFormData() {
      return currentFormData;
    }

    // 12ìš´ì„± ê³„ì‚° í•¨ìˆ˜
    function calculateSeyun12Unsung(dayGan, yearBranch) {
      const ganToBranch = {
        'ç”²': { 'äº¥': 'ì¥ìƒ', 'å­': 'ëª©ìš•', 'ä¸‘': 'ê´€ëŒ€', 'å¯…': 'ê±´ë¡', 'å¯': 'ì œì™•', 'è¾°': 'ì‡ ', 'å·³': 'ë³‘', 'åˆ': 'ì‚¬', 'æœª': 'ë¬˜', 'ç”³': 'ì ˆ', 'é…‰': 'íƒœ', 'æˆŒ': 'ì–‘' },
        'ä¹™': { 'åˆ': 'ì¥ìƒ', 'å·³': 'ëª©ìš•', 'è¾°': 'ê´€ëŒ€', 'å¯': 'ê±´ë¡', 'å¯…': 'ì œì™•', 'ä¸‘': 'ì‡ ', 'å­': 'ë³‘', 'äº¥': 'ì‚¬', 'æˆŒ': 'ë¬˜', 'é…‰': 'ì ˆ', 'ç”³': 'íƒœ', 'æœª': 'ì–‘' },
        'ä¸™': { 'å¯…': 'ì¥ìƒ', 'å¯': 'ëª©ìš•', 'è¾°': 'ê´€ëŒ€', 'å·³': 'ê±´ë¡', 'åˆ': 'ì œì™•', 'æœª': 'ì‡ ', 'ç”³': 'ë³‘', 'é…‰': 'ì‚¬', 'æˆŒ': 'ë¬˜', 'äº¥': 'ì ˆ', 'å­': 'íƒœ', 'ä¸‘': 'ì–‘' },
        'ä¸': { 'é…‰': 'ì¥ìƒ', 'ç”³': 'ëª©ìš•', 'æœª': 'ê´€ëŒ€', 'åˆ': 'ê±´ë¡', 'å·³': 'ì œì™•', 'è¾°': 'ì‡ ', 'å¯': 'ë³‘', 'å¯…': 'ì‚¬', 'ä¸‘': 'ë¬˜', 'å­': 'ì ˆ', 'äº¥': 'íƒœ', 'æˆŒ': 'ì–‘' },
        'æˆŠ': { 'å¯…': 'ì¥ìƒ', 'å¯': 'ëª©ìš•', 'è¾°': 'ê´€ëŒ€', 'å·³': 'ê±´ë¡', 'åˆ': 'ì œì™•', 'æœª': 'ì‡ ', 'ç”³': 'ë³‘', 'é…‰': 'ì‚¬', 'æˆŒ': 'ë¬˜', 'äº¥': 'ì ˆ', 'å­': 'íƒœ', 'ä¸‘': 'ì–‘' },
        'å·±': { 'é…‰': 'ì¥ìƒ', 'ç”³': 'ëª©ìš•', 'æœª': 'ê´€ëŒ€', 'åˆ': 'ê±´ë¡', 'å·³': 'ì œì™•', 'è¾°': 'ì‡ ', 'å¯': 'ë³‘', 'å¯…': 'ì‚¬', 'ä¸‘': 'ë¬˜', 'å­': 'ì ˆ', 'äº¥': 'íƒœ', 'æˆŒ': 'ì–‘' },
        'åºš': { 'å·³': 'ì¥ìƒ', 'è¾°': 'ëª©ìš•', 'å¯': 'ê´€ëŒ€', 'å¯…': 'ê±´ë¡', 'ä¸‘': 'ì œì™•', 'å­': 'ì‡ ', 'äº¥': 'ë³‘', 'æˆŒ': 'ì‚¬', 'é…‰': 'ë¬˜', 'ç”³': 'ì ˆ', 'æœª': 'íƒœ', 'åˆ': 'ì–‘' },
        'è¾›': { 'å­': 'ì¥ìƒ', 'äº¥': 'ëª©ìš•', 'æˆŒ': 'ê´€ëŒ€', 'é…‰': 'ê±´ë¡', 'ç”³': 'ì œì™•', 'æœª': 'ì‡ ', 'åˆ': 'ë³‘', 'å·³': 'ì‚¬', 'è¾°': 'ë¬˜', 'å¯': 'ì ˆ', 'å¯…': 'íƒœ', 'ä¸‘': 'ì–‘' },
        'å£¬': { 'ç”³': 'ì¥ìƒ', 'é…‰': 'ëª©ìš•', 'æˆŒ': 'ê´€ëŒ€', 'äº¥': 'ê±´ë¡', 'å­': 'ì œì™•', 'ä¸‘': 'ì‡ ', 'å¯…': 'ë³‘', 'å¯': 'ì‚¬', 'è¾°': 'ë¬˜', 'å·³': 'ì ˆ', 'åˆ': 'íƒœ', 'æœª': 'ì–‘' },
        'ç™¸': { 'å¯': 'ì¥ìƒ', 'å¯…': 'ëª©ìš•', 'ä¸‘': 'ê´€ëŒ€', 'å­': 'ê±´ë¡', 'äº¥': 'ì œì™•', 'æˆŒ': 'ì‡ ', 'é…‰': 'ë³‘', 'ç”³': 'ì‚¬', 'æœª': 'ë¬˜', 'åˆ': 'ì ˆ', 'å·³': 'íƒœ', 'è¾°': 'ì–‘' }
      };

      return ganToBranch[dayGan]?.[yearBranch] || '-';
    }

    // DOM ë¡œë“œ ì‹œ ì´ˆê¸°í™”
    document.addEventListener('DOMContentLoaded', function() {
      updateLeap();
      document.getElementById('calendar').addEventListener('change', updateLeap);
    });

    // í¼ ì œì¶œ í•¨ìˆ˜ (ì „ì—­ í•¨ìˆ˜ë¡œ ì •ì˜)
    async function submitForm() {
      document.getElementById('loading').style.display = 'block';
      document.getElementById('error-container').style.display = 'none';
      document.getElementById('results-container').style.display = 'none';

      try {
        const genderRadio = document.querySelector('input[name="gender"]:checked');
        const params = new URLSearchParams({
          y: document.getElementById('y').value,
          m: document.getElementById('m').value,
          d: document.getElementById('d').value,
          hh: document.getElementById('hh').value,
          mm: document.getElementById('mm').value,
          calendar: document.getElementById('calendar').value,
          gender: genderRadio ? genderRadio.value : 'ì—¬'
        });

        if (document.getElementById('leap').checked) {
          params.append('leap', 'true');
        }

        const response = await fetch(`/api/saju?${params}`);
        const data = await response.json();

        document.getElementById('loading').style.display = 'none';

        if (!response.ok) {
          throw new Error(data.error || 'ê³„ì‚° ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
        }

        saveFormData(data.input);
        displayResults(data);

      } catch (error) {
        document.getElementById('loading').style.display = 'none';
        document.getElementById('error-message').textContent = error.message;
        document.getElementById('error-container').style.display = 'block';
      }
    }

    // ê²°ê³¼ ë Œë”ë§
    function displayResults(data) {
      const dt = new Date(data.converted_datetime);
      const formatted =
        `${dt.getFullYear()}.${dt.getMonth()+1}.${dt.getDate()}.` +
        `${dt.getHours()}ì‹œ ${dt.getMinutes()}ë¶„ ${dt.getSeconds()}ì´ˆ`;
      document.getElementById('converted-date').textContent = formatted;

      // ì„±ë³„ í‘œì‹œ
      const gender = data.input.gender;
      const genderText = gender === 'ë‚¨' ? 'ë‚¨ì„±' : 'ì—¬ì„±';
      document.getElementById('pillars-title').textContent = `ì‚¬ì£¼ 4ì£¼ (${genderText})`;

      ['hour','day','month','year'].forEach((p,i)=>{
        const ids=['pillar-hour','pillar-day','pillar-month','pillar-year'];
        document.getElementById(ids[i]).innerText = data.pillars[p]||'';
      });
      ['ëª©','í™”','í† ','ê¸ˆ','ìˆ˜'].forEach(e=>{
        document.getElementById(`elem-${e}`).innerText = data.five_elements[e]??'0';
      });
      // ì‹­ì„±Â·12ìš´ì„±
      const deepTypes=['ì‹­ì„±','ì •ê¸°ì§€ì§€ì‹­ì„±','ì§€ì§€ì‹­ì„±','ë´‰ë²•12ìš´ì„±','ê±°ë²•12ìš´ì„±'];
      let html='';
      deepTypes.forEach(type=>{
        html+=`<tr><th class="bg-secondary">${type}</th>`;
        ['hour','day','month','year'].forEach(p=>{
          html+=`<td>${data.deep[type]?.[p]||''}</td>`;
        });
        html+='</tr>';
      });
      document.getElementById('deep-body').innerHTML=html;
      // ì²œê°„ íŠ¹ìˆ˜ê´€ê³„
      const stemCont=document.getElementById('stem-relation-container');
      const stemList=document.getElementById('stem-relation-list');
      stemList.innerHTML='';
      if(data.stemRelations?.length){
        stemCont.style.display='block';
        data.stemRelations.forEach(r=>{
          const li=document.createElement('li');
          li.className='list-group-item bg-dark text-white';
          const names={hour:'ì‹œì£¼',day:'ì¼ì£¼',month:'ì›”ì£¼',year:'ì—°ì£¼'};
          li.innerText=`${names[r.pillar]} â–¶ ${r.desc}`;
          stemList.appendChild(li);
        });
      } else stemCont.style.display='none';
      // ì§€ì§€í˜•ì¶©íšŒí•©
      Object.keys(data.branchRelations||{}).forEach(cat=>{
        ['hour','day','month','year'].forEach(p=>{
          document.getElementById(`rel-${cat}-${p}`).innerText=
            data.branchRelations[cat]?.[p]||'';
        });
      });
      // ì‹ ì‚´ ì¢…í•©
      ['hour','day','month','year'].forEach(pos => {
        const branch12 = data.branchSals[pos] || [];
        document.getElementById(`sal-stem-${pos}`)
          .innerText = branch12.length ? branch12.join(', ') : 'â€“';

        const gan = data.ganSals[pos] || [];
        const special = data.specialSals[pos] || [];
        const gods = [...gan, ...special];
        document.getElementById(`sal-god-${pos}`)
          .innerText = gods.length ? gods.join(', ') : 'â€“';
      });

      // ëŒ€ìš´ í…Œì´ë¸” ì±„ìš°ê¸°
      if (data.fortune && data.fortune.dayun) {
        let closestDayun = null;
        const currentYear = new Date().getFullYear();
        let currentYearDaeunAge = null;

        data.fortune.dayun.forEach(dayun => {
          const startAge = parseInt(dayun.age_range);
          if (isNaN(startAge)) return;

          if (data.fortune.current_age >= startAge && data.fortune.current_age <= startAge + 9) {
            closestDayun = dayun;
            currentYearDaeunAge = startAge;
          }

          const idx = data.fortune.dayun.indexOf(dayun) + 1;

          const ageCell = document.getElementById(`daeun-age-${idx}`);
          ageCell.textContent = dayun.age_range || '-';
          ageCell.style.cursor = 'pointer';
          ageCell.style.color = '#0dcaf0';
          ageCell.style.textDecoration = 'underline';

          ageCell.addEventListener('click', function() {
            const startAge = parseInt(dayun.age_range);
            if (!isNaN(startAge)) {
              updateSeyunByAge(startAge, data);
            }
          });

          document.getElementById(`daeun-gan-${idx}`).textContent = dayun.ganzhi || '-';

          if (dayun.stem) {
            const dayGan = data.pillars.day[0];
            const tenGod = getGanTenGod(dayGan, dayun.stem);
            document.getElementById(`daeun-ji-${idx}`).textContent = tenGod;
          }

          if (dayun.branch) {
            const dayGan = data.pillars.day[0];
            const hiddenGan = getBranchHiddenGan(dayun.branch);
            const branchTenGod = getGanTenGod(dayGan, hiddenGan);
            document.getElementById(`daeun-sipseong-${idx}`).textContent = branchTenGod;
          }

          const salText = dayun.sal && dayun.sal.length > 0 ? dayun.sal.join(', ') : '-';
          document.getElementById(`daeun-sal-${idx}`).textContent = salText;

          const unsung12Text = dayun['12unsung'] || '-';
          document.getElementById(`daeun-12unsung-${idx}`).textContent = unsung12Text;
        });

        if (data.fortune && data.fortune.dayun && currentYearDaeunAge !== null) {
          for (let i = 1; i <= 10; i++) {
            const ageCell = document.getElementById(`daeun-age-${i}`);
            if (ageCell && ageCell.textContent &&
                parseInt(ageCell.textContent) === currentYearDaeunAge) {
              ageCell.style.backgroundColor = '#28a745';
              ageCell.style.fontWeight = 'bold';
              ageCell.style.borderRadius = '8px';
              ageCell.style.border = '2px solid #fff';
              break;
            }
          }
        }
      }

      // ì„¸ìš´ í…Œì´ë¸” ì±„ìš°ê¸°
      let closestDayun = null;
      data.fortune.dayun.forEach(dayun => {
        const startAge = parseInt(dayun.age_range);
        const endAge = startAge + 9;
        if (data.fortune.current_age >= startAge && data.fortune.current_age <= endAge) {
          closestDayun = dayun;
        }
      });

      // í˜„ì¬ ì—°ë„ë¥¼ ê¸°ì¤€ìœ¼ë¡œ ì„¸ìš´ ê³„ì‚° (2025ë…„ì´ ì¤‘ì•™ì— ì˜¤ë„ë¡)
      const currentYear = new Date().getFullYear(); // 2025ë…„
      const baseYear = currentYear;

      for (let i = 0; i < 10; i++) {
        // í˜„ì¬ ì—°ë„ë¥¼ ì¤‘ì‹¬ìœ¼ë¡œ ì¢Œìš° 5ë…„ì”© ë°°ì¹˜ (ì™¼ìª½ë¶€í„° ë‚´ë¦¼ì°¨ìˆœ)
        // ìˆœì„œ: 2029, 2028, 2027, 2026, 2025, 2024, 2023, 2022, 2021, 2020
        const year = baseYear + 5 - i;
        const idx = i + 1;
        const currentYear = new Date().getFullYear();
        const isCurrentYear = (year === currentYear);

        const seuunYearElement = document.getElementById(`seuun-year-${idx}`);
        seuunYearElement.textContent = `${year}ë…„`;
        seuunYearElement.style.cursor = 'pointer';
        seuunYearElement.style.color = '#0dcaf0';
        seuunYearElement.style.textDecoration = 'underline';

        if (seuunYearElement.clickHandler) {
          seuunYearElement.removeEventListener('click', seuunYearElement.clickHandler);
        }
        seuunYearElement.clickHandler = function() {
          for (let j = 1; j <= 10; j++) {
            const cell = document.getElementById(`seuun-year-${j}`);
            if (cell) {
              cell.style.backgroundColor = '';
              cell.style.fontWeight = '';
              cell.style.borderRadius = '';
              cell.style.border = '';
              cell.style.color = '#0dcaf0';
            }
          }

          seuunYearElement.style.backgroundColor = '#28a745';
          seuunYearElement.style.fontWeight = 'bold';
          seuunYearElement.style.borderRadius = '8px';
          seuunYearElement.style.border = '2px solid #fff';
          seuunYearElement.style.color = 'white';

          const seuunTitle = document.getElementById('seuun-title');
          if (seuunTitle) {
            seuunTitle.textContent = `ì„¸ìš´(ë…„ìš´) (${year}ë…„)`;
          }

          updateWolunBySeuunYear(year, data);
        };
        seuunYearElement.addEventListener('click', seuunYearElement.clickHandler);

        const yearGanZhi = getYearGanZhi(year);
        document.getElementById(`seuun-gan-${idx}`).textContent = yearGanZhi;

        const yearStem = yearGanZhi[0];
        const dayGan = data.pillars.day[0];
        const yearTenGod = getGanTenGod(dayGan, yearStem);
        document.getElementById(`seuun-cheongan-${idx}`).textContent = yearTenGod;

        const yearBranch = yearGanZhi[1];
        const yearHiddenGan = getBranchHiddenGan(yearBranch);
        const yearBranchTenGod = getGanTenGod(dayGan, yearHiddenGan);
        document.getElementById(`seuun-jiji-${idx}`).textContent = yearBranchTenGod;

        const branchOrder = ['å­', 'ä¸‘', 'å¯…', 'å¯', 'è¾°', 'å·³', 'åˆ', 'æœª', 'ç”³', 'é…‰', 'æˆŒ', 'äº¥'];
        const twelveSalsOrder = ['ë…„ì‚´', 'ì›”ì‚´', 'ë§ì‹ ì‚´', 'ì¥ì„±ì‚´', 'ë°˜ì•ˆì‚´', 'ì—­ë§ˆì‚´', 'ìœ¡í•´ì‚´', 'í™”ê°œì‚´', 'ê²ì‚´', 'ì¬ì‚´', 'ì²œì‚´', 'ì§€ì‚´'];
        const branchIdx = branchOrder.indexOf(yearBranch);
        const salText = branchIdx >= 0 ? twelveSalsOrder[branchIdx] : '-';
        document.getElementById(`seuun-sal-${idx}`).textContent = salText;

        const seyun12unsung = calculateSeyun12Unsung(dayGan, yearBranch);
        const seyunUnsungDefaultElement = document.getElementById(`seuun-12unsung-${idx}`);
        if (seyunUnsungDefaultElement) {
          seyunUnsungDefaultElement.textContent = seyun12unsung;
        }

        if (isCurrentYear) {
          seuunYearElement.style.backgroundColor = '#28a745';
          seuunYearElement.style.fontWeight = 'bold';
          seuunYearElement.style.borderRadius = '8px';
          seuunYearElement.style.border = '2px solid #fff';
          seuunYearElement.style.color = 'white';

          const seuunTitle = document.getElementById('seuun-title');
          if (seuunTitle) {
            seuunTitle.textContent = `ì„¸ìš´(ë…„ìš´) (${year}ë…„)`;
          }

          setTimeout(() => updateWolunBySeuunYear(year, data), 100);
        }
      }

      if (closestDayun) {
        const closestStartAge = parseInt(closestDayun.age_range);

        const daeunTitle = document.getElementById('daeun-title');
        if (daeunTitle && !isNaN(closestStartAge)) {
          daeunTitle.innerHTML = `ëŒ€ìš´ (${closestStartAge}ì„¸) <small style="font-size: 0.6rem;">[í•œêµ­ì²œë¬¸ì—°êµ¬ì› ê¸°ì¤€]</small>`;
        }

        for (let i = 1; i <= 10; i++) {
          const ageCell = document.getElementById(`daeun-age-${i}`);
          if (ageCell && ageCell.textContent === closestDayun.age_range) {
            ageCell.style.backgroundColor = '#28a745';
            ageCell.style.fontWeight = 'bold';
            ageCell.style.color = 'white';
            break;
          }
        }
      }

      document.getElementById('copy-btn').style.display = 'block';
      document.getElementById('copy-info').style.display = 'block';
      document.getElementById('results-container').style.display = 'block';

      document.getElementById('results-container')
        .scrollIntoView({ behavior: 'smooth', block: 'start' });
    }

    // ëŒ€ìš´ ë‚˜ì´ì— ë”°ë¥¸ ì„¸ìš´ ì—…ë°ì´íŠ¸ í•¨ìˆ˜
    function updateSeyunByAge(startAge, data) {
      const birthYear = new Date(data.converted_datetime).getFullYear();
      const baseYear = birthYear + startAge;

      const daeunTitle = document.getElementById('daeun-title');
      if (daeunTitle) {
        daeunTitle.innerHTML = `ëŒ€ìš´ (${startAge}ì„¸) <small style="font-size: 0.6rem;">[í•œêµ­ì²œë¬¸ì—°êµ¬ì› ê¸°ì¤€]</small>`;
      }

      for (let i = 1; i <= 10; i++) {
        const ageCell = document.getElementById(`daeun-age-${i}`);
        if (ageCell) {
          ageCell.style.backgroundColor = '';
          ageCell.style.fontWeight = '';
          ageCell.style.color = '#0dcaf0';
          ageCell.style.borderRadius = '';
          ageCell.style.border = '';
        }
      }
      if (event && event.target) {
        event.target.style.backgroundColor = '#dc3545';
        event.target.style.fontWeight = 'bold';
        event.target.style.color = 'white';
        event.target.style.borderRadius = '8px';
        event.target.style.border = '2px solid #fff';
      }

      for (let i = 0; i < 10; i++) {
        // í´ë¦­ëœ ëŒ€ìš´ ë‚˜ì´ë¥¼ ê¸°ì¤€ìœ¼ë¡œ ì¢Œìš° 5ë…„ì”© ë°°ì¹˜ (ì™¼ìª½ë¶€í„° ë‚´ë¦¼ì°¨ìˆœ)
        const year = baseYear + 5 - i;
        const idx = i + 1;

        const seuunYearElement = document.getElementById(`seuun-year-${idx}`);
        seuunYearElement.textContent = `${year}ë…„`;
        seuunYearElement.style.cursor = 'pointer';
        seuunYearElement.style.color = '#0dcaf0';
        seuunYearElement.style.textDecoration = 'underline';

        if (seuunYearElement.clickHandler) {
          seuunYearElement.removeEventListener('click', seuunYearElement.clickHandler);
        }
        seuunYearElement.clickHandler = function() {
          for (let j = 1; j <= 10; j++) {
            const cell = document.getElementById(`seuun-year-${j}`);
            if (cell) {
              cell.style.backgroundColor = '';
              cell.style.fontWeight = '';
              cell.style.borderRadius = '';
              cell.style.border = '';
              cell.style.color = '#0dcaf0';
            }
          }

          seuunYearElement.style.backgroundColor = '#28a745';
          seuunYearElement.style.fontWeight = 'bold';
          seuunYearElement.style.borderRadius = '8px';
          seuunYearElement.style.border = '2px solid #fff';
          seuunYearElement.style.color = 'white';

          const seuunTitle = document.getElementById('seuun-title');
          if (seuunTitle) {
            seuunTitle.textContent = `ì„¸ìš´(ë…„ìš´) (${year}ë…„)`;
          }

          updateWolunBySeuunYear(year, data);
        };
        seuunYearElement.addEventListener('click', seuunYearElement.clickHandler);

        const yearGanZhi = getYearGanZhi(year);
        document.getElementById(`seuun-gan-${idx}`).textContent = yearGanZhi;

        const yearStem = yearGanZhi[0];
        const dayGan = data.pillars.day[0];
        const yearTenGod = getGanTenGod(dayGan, yearStem);
        document.getElementById(`seuun-cheongan-${idx}`).textContent = yearTenGod;

        const yearBranch = yearGanZhi[1];
        const yearHiddenGan = getBranchHiddenGan(yearBranch);
        const yearBranchTenGod = getGanTenGod(dayGan, yearHiddenGan);
        document.getElementById(`seuun-jiji-${idx}`).textContent = yearBranchTenGod;

        const branchOrder = ['å­', 'ä¸‘', 'å¯…', 'å¯', 'è¾°', 'å·³', 'åˆ', 'æœª', 'ç”³', 'é…‰', 'æˆŒ', 'äº¥'];
        const twelveSalsOrder = ['ë…„ì‚´', 'ì›”ì‚´', 'ë§ì‹ ì‚´', 'ì¥ì„±ì‚´', 'ë°˜ì•ˆì‚´', 'ì—­ë§ˆì‚´', 'ìœ¡í•´ì‚´', 'í™”ê°œì‚´', 'ê²ì‚´', 'ì¬ì‚´', 'ì²œì‚´', 'ì§€ì‚´'];
        const branchIdx = branchOrder.indexOf(yearBranch);
        const salText = branchIdx >= 0 ? twelveSalsOrder[branchIdx] : '-';
        document.getElementById(`seuun-sal-${idx}`).textContent = salText;

        const seyun12unsung = calculateSeyun12Unsung(dayGan, yearBranch);
        document.getElementById(`seuun-12unsung-${idx}`).textContent = seyun12unsung;
      }
    }

    // ì„¸ìš´ì—°ë„ì— ë”°ë¥¸ ì›”ìš´ ì—…ë°ì´íŠ¸ í•¨ìˆ˜
    async function updateWolunBySeuunYear(year, data) {
      try {
        const formData = getCurrentFormData();
        if (!formData) {
          console.error('Form ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.');
          return;
        }

        const response = await fetch(`/api/saju?y=${formData.y}&m=${formData.m}&d=${formData.d}&hh=${formData.hh}&mm=${formData.mm}&calendar=${formData.calendar}&gender=${encodeURIComponent(formData.gender)}&fortune_year=${year}`);

        if (!response.ok) {
          console.error(`ì›”ìš´ ë°ì´í„° ìš”ì²­ ì‹¤íŒ¨: ${response.status}`);
          return;
        }

        const sajuData = await response.json();
        const wolyunData = sajuData.fortune?.wolyun || [];

        if (wolyunData && wolyunData.length > 0) {
          displayWolunData(wolyunData);
          console.log(`${year}ë…„ ì›”ìš´ ë°ì´í„° ì—…ë°ì´íŠ¸ ì™„ë£Œ`);
        } else {
          console.warn(`${year}ë…„ ì›”ìš´ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.`);
          displayWolunData([]);
        }
      } catch (error) {
        console.error('ì›”ìš´ ë°ì´í„° ì—…ë°ì´íŠ¸ ì˜¤ë¥˜:', error);
        displayWolunData([]);
      }
    }

    // ì›”ìš´ ë°ì´í„° í‘œì‹œ í•¨ìˆ˜
    function displayWolunData(wolyunData) {
      for (let i = 1; i <= 12; i++) {
        const monthCell = document.getElementById(`wolun-month-${i}`);
        const ganjiCell = document.getElementById(`wolun-gan-${i}`);
        const salCell = document.getElementById(`wolun-sal-${i}`);
        const unCell = document.getElementById(`wolun-12unsung-${i}`);
        const stemTengodCell = document.getElementById(`wolun-cheongan-${i}`);
        const branchTengodCell = document.getElementById(`wolun-jiji-${i}`);

        if (monthCell) monthCell.textContent = '-';
        if (ganjiCell) ganjiCell.textContent = '-';
        if (salCell) salCell.textContent = '-';
        if (unCell) unCell.textContent = '-';
        if (stemTengodCell) stemTengodCell.textContent = '-';
        if (branchTengodCell) branchTengodCell.textContent = '-';
      }

      wolyunData.forEach((wolyun, index) => {
        const position = index + 1;

        const monthCell = document.getElementById(`wolun-month-${position}`);
        if (monthCell) {
          monthCell.textContent = wolyun.month_name || `${wolyun.month}ì›”`;
        }

        const ganjiCell = document.getElementById(`wolun-gan-${position}`);
        if (ganjiCell) {
          ganjiCell.textContent = wolyun.ganzhi || '-';
        }

        const salCell = document.getElementById(`wolun-sal-${position}`);
        if (salCell) {
          salCell.textContent = (wolyun.sal && wolyun.sal.length > 0) ? wolyun.sal.join(', ') : '-';
        }

        const unCell = document.getElementById(`wolun-12unsung-${position}`);
        if (unCell) {
          unCell.textContent = wolyun['12unsung'] || '-';
        }

        const stemTengodCell = document.getElementById(`wolun-cheongan-${position}`);
        if (stemTengodCell) {
          stemTengodCell.textContent = wolyun.stem_tengod || '-';
        }

        const branchTengodCell = document.getElementById(`wolun-jiji-${position}`);
        if (branchTengodCell) {
          branchTengodCell.textContent = wolyun.branch_tengod || '-';
        }
      });
    }

    // Markdown ë³µì‚¬
    function copyAll() {
      let md = '';
      const tables = document.querySelectorAll('#results-container table');

      tables.forEach((table, idx) => {
        if (idx === 0) {
          const sajuTitle = document.getElementById('pillars-title').textContent || 'ì‚¬ì£¼ 4ì£¼';
          md += `## ${sajuTitle}\n`;
        }
        if (idx === 1) md += '## ì˜¤í–‰ ë¶„í¬\n';
        if (idx === 2) md += '## ì‹¬ì¸µ ë¶„ì„: ì‹­ì„± & 12ìš´ì„±\n';

        if (idx <= 2) {
          const heads = Array.from(table.querySelectorAll('thead th'))
                             .map(th => th.innerText.trim());
          md += `| ${heads.join(' | ')} |\n`;
          md += `|${heads.map(() => ':---:').join('|')}|\n`;
          table.querySelectorAll('tbody tr').forEach(tr => {
            const cells = Array.from(tr.children).map(td => td.innerText.trim());
            md += `| ${cells.join(' | ')} |\n`;
          });
          md += '\n';
        }

        if (idx === 2) {
          const lis = document.querySelectorAll('#stem-relation-list li');
          if (lis.length) {
            md += '## ì²œê°„ íŠ¹ìˆ˜ê´€ê³„\n';
            md += '| ê¸°ë‘¥ | ê´€ê³„ ì„¤ëª… |\n';
            md += '|:---:|:---:|\n';
            lis.forEach(li => {
              const [pillar, desc] = li.innerText.split('â–¶').map(s => s.trim());
              md += `| ${pillar} | ${desc} |\n`;
            });
            md += '\n';
          }
        }

        if (idx === 3) md += '## ì§€ì§€í˜•ì¶©íšŒí•© í•´ì„\n';
        if (idx === 4) md += '## ì²œê°„Â·ì§€ì§€ ì‹ ì‚´ ì¢…í•©\n';

        if (idx >= 3 && idx <= 4) {
          const heads = Array.from(table.querySelectorAll('thead th'))
                             .map(th => th.innerText.trim());
          md += `| ${heads.join(' | ')} |\n`;
          md += `|${heads.map(() => ':---:').join('|')}|\n`;
          table.querySelectorAll('tbody tr').forEach(tr => {
            const cells = Array.from(tr.children).map(td => td.innerText.trim());
            md += `| ${cells.join(' | ')} |\n`;
          });
          md += '\n';
        }
      });

      const daeunTitleElement = document.getElementById('daeun-title');
      const daeunTitle = daeunTitleElement ? daeunTitleElement.textContent : 'ëŒ€ìš´';
      md += `## ${daeunTitle}\n`;
      md += '| êµ¬ë¶„ | 1 | 2 | 3 | 4 | 5 | 6 | 7 | 8 | 9 | 10 |\n';
      md += '|:---:|:---:|:---:|:---:|:---:|:---:|:---:|:---:|:---:|:---:|:---:|\n';

      const daeunRows = [
        { label: '**ëŒ€ìš´ë‚˜ì´**', prefix: 'daeun-age' },
        { label: '**ê°„ì§€**', prefix: 'daeun-gan' },
        { label: '**ì²œê°„ì‹­ì„±**', prefix: 'daeun-ji' },
        { label: '**ì§€ì§€ì‹­ì„±**', prefix: 'daeun-sipseong' },
        { label: '**ì‹ ì‚´**', prefix: 'daeun-sal' },
        { label: '**12ìš´ì„±**', prefix: 'daeun-12unsung' }
      ];

      daeunRows.forEach(row => {
        const rowData = [row.label];
        for (let i = 1; i <= 10; i++) {
          const element = document.getElementById(`${row.prefix}-${i}`);
          const value = element ? element.textContent.trim() : '-';
          rowData.push(value || '-');
        }
        md += `| ${rowData.join(' | ')} |\n`;
      });
      md += '\n';

      const seuunTitleElement = document.getElementById('seuun-title');
      const seuunTitle = seuunTitleElement ? seuunTitleElement.textContent : 'ì„¸ìš´(ë…„ìš´)';
      md += `## ${seuunTitle}\n`;
      md += '| êµ¬ë¶„ | 1 | 2 | 3 | 4 | 5 | 6 | 7 | 8 | 9 | 10 |\n';
      md += '|:---:|:---:|:---:|:---:|:---:|:---:|:---:|:---:|:---:|:---:|:---:|\n';

      const seuunRows = [
        { label: '**ì„¸ìš´ì—°ë„**', prefix: 'seuun-year' },
        { label: '**ê°„ì§€**', prefix: 'seuun-gan' },
        { label: '**ì²œê°„ì‹­ì„±**', prefix: 'seuun-cheongan' },
        { label: '**ì§€ì§€ì‹­ì„±**', prefix: 'seuun-jiji' },
        { label: '**ì‹ ì‚´**', prefix: 'seuun-sal' },
        { label: '**12ìš´ì„±**', prefix: 'seuun-12unsung' }
      ];

      seuunRows.forEach(row => {
        const rowData = [row.label];
        for (let i = 1; i <= 10; i++) {
          const element = document.getElementById(`${row.prefix}-${i}`);
          const value = element ? element.textContent.trim() : '-';
          rowData.push(value || '-');
        }
        md += `| ${rowData.join(' | ')} |\n`;
      });
      md += '\n';

      md += '## ì›”ìš´\n';
      md += '| êµ¬ë¶„ | 1ì›” | 2ì›” | 3ì›” | 4ì›” | 5ì›” | 6ì›” | 7ì›” | 8ì›” | 9ì›” | 10ì›” | 11ì›” | 12ì›” |\n';
      md += '|:---:|:---:|:---:|:---:|:---:|:---:|:---:|:---:|:---:|:---:|:---:|:---:|:---:|\n';

      const wolunRows = [
        { label: '**ì›”ìš´ì›”**', prefix: 'wolun-month' },
        { label: '**ê°„ì§€**', prefix: 'wolun-gan' },
        { label: '**ì²œê°„ì‹­ì„±**', prefix: 'wolun-cheongan' },
        { label: '**ì§€ì§€ì‹­ì„±**', prefix: 'wolun-jiji' },
        { label: '**ì‹ ì‚´**', prefix: 'wolun-sal' },
        { label: '**12ìš´ì„±**', prefix: 'wolun-12unsung' }
      ];

      wolunRows.forEach(row => {
        const rowData = [row.label];
        for (let i = 1; i <= 12; i++) {
          const element = document.getElementById(`${row.prefix}-${i}`);
          const value = element ? element.textContent.trim() : '-';
          rowData.push(value || '-');
        }
        md += `| ${rowData.join(' | ')} |\n`;
      });
      md += '\n';

      md = md.trimEnd();

      navigator.clipboard.writeText(md)
        .then(() => {
          alert('ì‚¬ì£¼ ê²°ê³¼ê°€ ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤! ChatGPTì— ë¶™ì—¬ë„£ê¸° í•˜ì„¸ìš”.');

          const referrer = document.referrer;
          const isFromGPT = referrer && referrer.includes('chatgpt.com');

          if (isFromGPT) {
            if (window.history.length > 1) {
              window.history.back();
            } else {
              window.close();
            }
          } else {
            window.open('https://chatgpt.com/g/g-bOHE77cGN-sajupalja-myeongrihag-bangmunyul-1wi-unse-saju-gunghab-insaeng-saeob-janyeo-gilil', '_blank');
          }
        })
        .catch(err => {
          console.error('ë³µì‚¬ ì‹¤íŒ¨:', err);
          alert('ë³µì‚¬ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤. ë¸Œë¼ìš°ì €ì—ì„œ ìˆ˜ë™ìœ¼ë¡œ ë³µì‚¬í•´ì£¼ì„¸ìš”.');
        });
    }

  </script>
    <!-- ê°œì¸ì •ë³´ì²˜ë¦¬ë°©ì¹¨ footer -->
  <footer class="text-center mt-5 py-4 border-top border-secondary">
    <small>
      <a href="https://www.notion.so/1ed8f27934448056993ee972299dc66f"
         target="_blank"
         class="text-decoration-none text-light">
        ğŸ“„ ê°œì¸ì •ë³´ì²˜ë¦¬ë°©ì¹¨
      </a>
    </small>
  </footer>
</body>
</html>